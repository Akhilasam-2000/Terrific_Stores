{{ '//code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css' | stylesheet_tag }}
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js" defer="defer"></script>
<div>

<label for="country">Select a Region </label>
<select >
<option value=""></option>
<option value="Dubai">Dubai</option>
<option value="Abu dhabhi">Abu dhabhi</option>
<option value="Sharjah">Sharjah</option>
</select>

<div style="width:300px; clear:both;">
  <p>
    <label for="date">Pick a delivery date:</label>
    <input id="date" type="text" name="attributes[date]" value="{{ cart.attributes.date }}" />
    <span style="display:block" class="instructions"> We do not deliver during the weekend.</span>
  </p>
</div>

<script>
  window.onload = function() {
    if (window.jQuery) {
      let $ = window.jQuery;

      $(function() {
        function formatDate(date) {
          let day = date.getDate();
          let month = date.getMonth() + 1;
          let year = date.getFullYear();
          return month + '/' + day + '/' + year;
        }

        function formatTime(date) {
          let hours = date.getHours();
          let minutes = date.getMinutes();
          return hours + ':' + minutes;
        }

        function logCurrentDateTime() {
          let currentDate = new Date();
          let currentTime = new Date();

          let formattedCurrentDate = formatDate(currentDate);
          let formattedCurrentTime = formatTime(currentTime);

          console.log("Current date:", formattedCurrentDate);
          console.log("Current time:", formattedCurrentTime);
        }

        function validateDelivery() {
          let selectedRegion = $("select").val();
          let selectedDate = $("#date").val();

          if (!selectedRegion || !selectedDate) {
            alert("Please select both the region and the delivery date.");
            return false;
          }

          if (selectedRegion === "Abu dhabi" || selectedRegion === "Sharjah") {
            let currentDate = new Date();
            let selectedDateTime = new Date(selectedDate + " 00:00");

            if (selectedDateTime <= currentDate) {
              alert("Same-day delivery is not possible for Abu Dhabi and Sharjah.");
              return false;
            }
          }
          if (selectedRegion === "Dubai") {
            let currentTime = new Date();
            let currentHour = currentTime.getHours();
            let currentMinutes = currentTime.getMinutes();

            if (currentHour >= 13 && currentMinutes >= 30) {
              alert("Same-day delivery is not possible for Dubai after 1:30 PM.");
              return false;
            }
          }

          return true;
        }

        $("#date").prop("disabled", true);

        $("select").on("change", function() {
          $("#date").prop("disabled", false);
          let selectedRegion = $(this).val();
          console.log("Selected region:", selectedRegion);
        });

        $("#date").datepicker({
          minDate: +1,
          maxDate: '+2M',
          beforeShowDay: $.datepicker.noWeekends,
          onSelect: logCurrentDateTime 
        });

        $("#submitBtn").on("click", function(event) {
          if (!validateDelivery()) {
            event.preventDefault();
          }
        });
      });
    }
  }
</script>
